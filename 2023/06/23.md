# 2023.06.22 TIL

## Study
### Spring
- 스프링 스터디 CGLIB [블로깅](https://memodayoungee.tistory.com/151)
### Spring Project
- ec2 환경변수 문제 해결
- OAuth 적용 후, 테스트 코드 빌드 실패 오류 해결
- DB H2 -> MySQL로 변경

## Reflection
- CGLIB와 JDK 동적 프록시는 스프링 AOP와 관련이 있다고는 알았지만, 엄청 깊이 ~~ 까지는 알지 못했다. JDK 동적 프록시의 한계와 CGLIB의 한계. 그리고
스프링 부트가 CGLIB를 사용하는 이유, 혹은 JDK 동적 프록시는 리플렉션을 사용해서 프록시를 생성하는 반면 CGLIB가 어떻게 프록시를 생성하는지
아무튼 내가 하고 싶은 말은 CGLIB의 원리에 대해서 까지 알게되어 좋은 시간이었다. 조금 신기한게 스프링을 배우다보면 여러 개념들이 결국 엮이고 엮여 마치 거미줄같은 형태를 하고 있는 것 같다.
이런 생각이 드니까 너무 신기했음..
- 오늘 프로젝트도 정~말 힘들었다 ㅠ MySQL로 변경하는 건 의외로 바로 돼서 놀랐다. 엔진엑스와 젠킨스는 직접 깔아서 실행했는데, MySQL은 도커를 사용했다. 메인 프로젝트는 모두 Docker로 사용할까 생각중이다.
하지만, 여기서 문제는 DB 주소와 username pw 전부 환경변수로 설정했는데, ec2에서 이 환경변수가 먹히지 않는다는 것이었다. 분명 리눅스에 환경변수를 등록했는데도 말이지 ㅠㅠㅠ
수많은 테스트 끝에 user 계정으로 서버를 실행하면 환경변수를 읽어온다는 것을 알았다. 로그를 봤을 때도 uri 주소가 환경변수 이름 그대로 출력 되길래 안먹힌 다는 건 알았지만, 권한의 문제로 안먹힐줄은 몰랐다..
분명 root 계정으로 배포를 했는데 왜 환경변수를 못 읽어오는 걸까.. 이에 대해 구글링 했지만 답은 찾을 수 없었다 ㅠ 해결책은 user 계정으로 바꿔서 서버를 실행해주는 것이었다.
그리고 마지막 또다른 문제. OAuth를 추가하고 나니 테스트 코드 대부분이 실패했다.(젠킨스에서) 젠킨스에서 테스트 통과가 되지않아 배포가 되지 않는 상황...
첫번째로 생각한 방법은 filter 단에서 OAuth만 빼주는 방법이 있나 찾아봤지만, Spring Securiy 자체를 빼줘야 해서 이 방법은 포기했다..(NPE 발생하는 문제때문에 뺄 수 없음)
그리고 두번째 방법은 시큐리티 설정 클래스를 test용으로 하나 더 만들어 Oauth만 빼주는 방법을 생각해봤는데, 이것 또한 fail
결국 성공해낸 방법은 test용 설정 파일을 만들어 더미 데이터를 넣어놓는 것이었다. 운영용과 다른 데이터를 집어 넣어 보안의 문제는 딱히 없다.
DB 관련해서는 test 쪽은 H2를 쓰게 설정했다. 이렇게 나는 또 무려 9시부터 10시 반까지 의자에 앉아 하루종일 트러블 슈팅했다..
오류 해결하느라 오늘 역시 알고리즘 문제를 풀지 못했다.. 하지만 이제 프로젝트에서 할 수 있는 건 전부 다 해놓았기 때문에 내일부터는 정말 문제에 집중할 수 있을 것이다 ㅠ 돌잔치에 가야해서 할 수 이씅ㄹ지는 모르겠지만
## Tommorow I'll Learn
- 알고리즘 1문제
- SQL 1문제


